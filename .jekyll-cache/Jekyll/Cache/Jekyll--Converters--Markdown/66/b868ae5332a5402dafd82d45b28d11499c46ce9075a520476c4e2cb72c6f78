I"–-<p>Dockerå®¹å™¨éƒ¨ç½²ä¸æ•°æ®å·æŒä¹…åŒ–</p>

<h1 id="dockerå®æˆ˜å®‰è£…">Dockerå®æˆ˜å®‰è£…</h1>

<p>ç»ƒä¹ dockeréƒ¨ç½²å®¹å™¨ ç†Ÿæ‚‰ç›¸å…³æ“ä½œ</p>

<h2 id="dockerå®‰è£…nginx">Dockerå®‰è£…Nginx</h2>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1ã€æœç´¢é•œåƒ search å»ºè®®å»dockerä¸Šæœç´¢ å¯ä»¥çœ‹åˆ°å¸®åŠ©æ–‡æ¡£</span>
<span class="c"># 2ã€ä¸‹è½½é•œåƒ</span>
<span class="c"># 3ã€è¿è¡Œæµ‹è¯•</span>
<span class="o">[</span>root@localhost ~]# docker pull nginx 
<span class="c">#-d åå°è¿è¡Œ</span>
<span class="c">#--name ç»™å®¹å™¨å‘½å</span>
<span class="c">#-p å®¿ä¸»æœºç«¯å£:å®¹å™¨å†…éƒ¨ç«¯å£</span>
<span class="o">[</span>root@localhost ~]# docker run <span class="nt">-d</span> <span class="nt">--name</span> nginx01 <span class="nt">-p</span>:3344:80 nginx
<span class="o">[</span>root@localhost ~]# docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES
322d937e89a9        nginx               <span class="s2">"/docker-entrypoint.â€¦"</span>   10 seconds ago      Up 4 seconds        0.0.0.0:3344-&gt;80/tcp   nginx01
<span class="o">[</span>root@localhost ~]# curl  localhost:3344
<span class="c">#è¿›å…¥å®¹å™¨</span>
<span class="o">[</span>root@localhost ~]# docker <span class="nb">exec</span> <span class="nt">-it</span> nginx01 /bin/bash
root@322d937e89a9:/# whereis nginx        
nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx
root@322d937e89a9:/# <span class="nb">cd</span> /etc/nginx/
root@322d937e89a9:/etc/nginx# <span class="nb">ls
</span>conf.d	fastcgi_params	koi-utf  koi-win  mime.types  modules  nginx.conf  scgi_params	uwsgi_params  win-utf
</code></pre></div></div>

<h2 id="dockerå®‰è£…tomcat">Dockerå®‰è£…Tomcat</h2>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#docker run -it --rm ä¸€èˆ¬ç”¨æ¥æµ‹è¯• ç”¨å®Œå°±åˆ é™¤</span>
docker run <span class="nt">-it</span> <span class="nt">--rm</span> tomcat 
<span class="c">#å…ˆä¸‹è½½Docker</span>
docker pull tomcat
<span class="c">#å¯åŠ¨è¿è¡Œ</span>
docker run <span class="nt">-d</span>  <span class="nt">--name</span> tomcat01 <span class="nt">-p</span> 80:8080 tomcat
<span class="c">#é»˜è®¤404 å› ä¸ºé»˜è®¤tomcatå®¹å™¨ä¸­webappsä¸‹æ²¡æœ‰å†…å®¹éœ€è¦æŠŠwebapps.distä¸‹çš„å†…å®¹å¤åˆ¶åˆ°webapps</span>
<span class="o">[</span>root@localhost ~]# docker <span class="nb">exec</span> <span class="nt">-it</span> tomcat01 /bin/bash
root@8b2eb48c88d7:/usr/local/tomcat# <span class="nb">ls
</span>BUILDING.txt	 LICENSE  README.md	 RUNNING.txt  conf  logs	    temp     webapps.dist
CONTRIBUTING.md  NOTICE   RELEASE-NOTES  bin	      lib   native-jni-lib  webapps  work
root@8b2eb48c88d7:/usr/local/tomcat# <span class="nb">cp</span> <span class="nt">-r</span> webapps.dist/<span class="k">*</span> webapps/
<span class="c">#åˆ·æ–°å†è®¿é—®å³å¯</span>
</code></pre></div></div>

<h2 id="dockeréƒ¨ç½²es">Dockeréƒ¨ç½²es</h2>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#es æš´éœ²çš„ç«¯å£å¾ˆå¤š</span>
<span class="c">#es ååˆ†è€—å†…å­˜</span>
<span class="c">#esçš„æ•°æ®ä¸€èˆ¬éœ€è¦æ”¾åˆ°å®‰å…¨ç›®å½• æŒ‚è½½</span>
<span class="c"># --net somenetwork ç½‘ç»œé…ç½®</span>

<span class="o">[</span>root@localhost ~]# docker run <span class="nt">-d</span> <span class="nt">--name</span> es  <span class="nt">-p</span> 9200:9200 <span class="nt">-p</span> 9300:9300 <span class="nt">-e</span> <span class="s2">"discovery.type=single-node"</span> elasticsearch
28c62430ef6170fa965d1f3d30f94d71c4fb166b12f18184f35e1d924b77b009
<span class="o">[</span>root@localhost ~]# docker ps 
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                            NAMES
28c62430ef61        elasticsearch       <span class="s2">"/docker-entrypoint.â€¦"</span>   21 seconds ago      Up 20 seconds       0.0.0.0:9200-&gt;9200/tcp, 0.0.0.0:9300-&gt;9300/tcp   es
<span class="c">#æµ‹è¯•è®¿é—®</span>
<span class="o">[</span>root@localhost ~]# curl localhost:9200
<span class="o">{</span>
  <span class="s2">"name"</span> : <span class="s2">"2Cl8W2u"</span>,
  <span class="s2">"cluster_name"</span> : <span class="s2">"elasticsearch"</span>,
  <span class="s2">"cluster_uuid"</span> : <span class="s2">"M2RZefmIQH-9xmVofqzbfA"</span>,
  <span class="s2">"version"</span> : <span class="o">{</span>
    <span class="s2">"number"</span> : <span class="s2">"5.6.12"</span>,
    <span class="s2">"build_hash"</span> : <span class="s2">"cfe3d9f"</span>,
    <span class="s2">"build_date"</span> : <span class="s2">"2018-09-10T20:12:43.732Z"</span>,
    <span class="s2">"build_snapshot"</span> : <span class="nb">false</span>,
    <span class="s2">"lucene_version"</span> : <span class="s2">"6.6.1"</span>
  <span class="o">}</span>,
  <span class="s2">"tagline"</span> : <span class="s2">"You Know, for Search"</span>
<span class="o">}</span>
<span class="o">[</span>root@localhost ~]# 
<span class="c">#æŸ¥çœ‹dokcercpuçŠ¶æ€</span>
<span class="o">[</span>root@localhost ~]# docker stats es

CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT     MEM %               NET I/O             BLOCK I/O           PIDS
28c62430ef61        es                  100.69%             1.309GiB / 3.686GiB   35.51%              2.2kB / 0B          0B / 0B             4

<span class="c">#esä¿®æ”¹JAVAå†…å­˜</span>
<span class="o">[</span>root@localhost ~]# docker run <span class="nt">-d</span> <span class="nt">--name</span> es1  <span class="nt">-p</span> 9200:9200 <span class="nt">-p</span> 9300:9300 <span class="nt">-e</span> <span class="s2">"discovery.type=single-node"</span> <span class="nt">-e</span> <span class="nv">ES_JAVA_OPTS</span><span class="o">=</span><span class="s2">"-Xms64m -Xms512m"</span> elasticsearch
adf66348505a744a1b2193870e184bdcfe39e3bfb7b32b9d9a77d9ee4cc3897e
<span class="c">#æŸ¥çœ‹dokcercpuçŠ¶æ€</span>

</code></pre></div></div>

<h1 id="ä½¿ç”¨æ•°æ®å·">ä½¿ç”¨æ•°æ®å·</h1>

<p>æ•°æ®å·å¯ä»¥åœ¨å®¹å™¨ä¹‹é—´å…±äº«å’Œé‡ç”¨
å¯¹æ•°æ®å·çš„ä¿®æ”¹ä¼šç«‹é©¬ç”Ÿæ•ˆ
å¯¹æ•°æ®å·çš„æ›´æ–°ï¼Œ ä¸ä¼šå½±å“é•œåƒ
æ•°æ®å·é»˜è®¤ä¼šä¸€ç›´å­˜åœ¨ï¼Œ å³ä½¿å®¹å™¨è¢«åˆ é™¤</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-it</span> <span class="nt">-v</span>  <span class="c">#å®¿ä¸»æœºè·¯å¾„:å®¹å™¨è·¯å¾„ é•œåƒå</span>
docker run <span class="nt">-it</span> <span class="nt">-v</span>  /opt/docker-centos/:/home centos /bin/bash
</code></pre></div></div>

<h2 id="å®‰è£…mysql">å®‰è£…MySQL</h2>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#è·å–mysqlé•œåƒ</span>
<span class="o">[</span>root@localhost docker-centos]# docker pull mysql:5.7
<span class="c">#å®˜æ–¹æµ‹è¯• docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span>
<span class="c">#ä½¿ç”¨æ•°æ®å·éƒ¨ç½²</span>
<span class="c"># -d åå°è¿è¡Œ</span>
<span class="c"># -p ç«¯å£æ˜ å°„</span>
<span class="c"># -v å·æŒ‚è½½</span>
<span class="c"># --name å®¹å™¨åå­—</span>
<span class="o">[</span>root@localhost /]# docker run <span class="nt">-d</span> <span class="nt">-p</span> 3301:3306 <span class="nt">-v</span> /opt/docker-mysql/conf:/etc/mysql/conf.d <span class="nt">-v</span> /opt/docker-mysql/data:/var/lib/mysql <span class="nt">-eMYSQL_ROOT_PASSWORD</span><span class="o">=</span>123456 <span class="nt">--name</span> mysql01 mysql:5.7
<span class="c">#å¯åŠ¨æˆåŠŸ æœ¬åœ°è¿æ¥ä¸€ä¸‹æˆ–è€…æŸ¥çœ‹3301ç«¯å£æ˜¯å¦å­˜åœ¨</span>
</code></pre></div></div>

<h2 id="å…·åæŒ‚è½½å’ŒåŒ¿åæŒ‚è½½">å…·åæŒ‚è½½å’ŒåŒ¿åæŒ‚è½½</h2>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#æŸ¥çœ‹æ‰€æœ‰ volume çš„æƒ…å†µ</span>
<span class="c">#åŒ¿åæŒ‚è½½</span>
<span class="c">#-v å®¹å™¨å†…è·¯å¾„</span>
docker run <span class="nt">-d</span> <span class="nt">-P</span> <span class="nt">--name</span> nginx12 <span class="nt">-v</span> /etc/nginx nginx
<span class="o">[</span>root@localhost data]# docker volume <span class="nb">ls
</span>DRIVER              VOLUME NAME
<span class="nb">local               </span>280bc04bb4286c3f63ce7ec6146cb4e3165b04950ab0bf57887fc51e655e6f99
<span class="c">#å…·åæŒ‚è½½</span>
<span class="o">[</span>root@localhost data]# docker run <span class="nt">-d</span> <span class="nt">-P</span> <span class="nt">--name</span> nginx13 <span class="nt">-v</span> nginx:/etc/nginx nginx
9694d2d47e9ff1ee8ca4e020ff6a3f045ac4a0f6d50965ccc3341e556d9903b9
<span class="o">[</span>root@localhost data]# docker volume <span class="nb">ls
</span>DRIVER              VOLUME NAME
<span class="nb">local               </span>nginx

<span class="c">#æŸ¥çœ‹æŒ‚è½½è·¯å¾„</span>
</code></pre></div></div>

<p><img src="https://i.opsta.cn/docker/docker-volumes-nginx.png" alt="image-20200620220843507" />)</p>

<p>æ‰€æœ‰dockerå®¹å™¨å†…çš„å·,æ²¡æœ‰æŒ‡å®šç›®å½•çš„æƒ…å†µä¸‹éƒ½æ˜¯åœ¨/var/lib/docker/volumes/***/_data</p>

<p>å¯ä»¥é€šè¿‡å…·åæŒ‚è½½æ–¹ä¾¿æ‰¾åˆ°è·¯å¾„</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">-v</span> å®¹å™¨å†…è·¯å¾„ <span class="c">#åŒ¿åæŒ‚è½½</span>
<span class="nt">-v</span> /å®¿ä¸»æœºè·¯å¾„:å®¹å™¨å†…è·¯å¾„ <span class="c">#æŒ‡å®šè·¯å¾„æŒ‚è½½</span>
<span class="nt">-v</span> å·å:å®¹å™¨å†…è·¯å¾„ <span class="c">#å…·åæŒ‚è½½</span>
</code></pre></div></div>

<p>æ‰©å±•</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#å¯ä»¥é€šè¿‡ -v å®¹å™¨å†…è·¯å¾„ ro rw æ”¹å˜è¯»å†™æƒé™</span>
ro <span class="nb">readonly</span> <span class="c">#åªè¯»</span>
rw readwrite <span class="c">#è¯»å†™</span>
ä¸€æ—¦è®¾ç½®äº†roé‚£ä¹ˆå®¹å™¨å°±æ— æ³•å†™æ–‡ä»¶ åªèƒ½é€šè¿‡å®¿ä¸»æœºæ¥æ“ä½œ
</code></pre></div></div>

<h1 id="æ•°æ®å·å®¹å™¨">æ•°æ®å·å®¹å™¨</h1>

<p>å¦‚æœä½ æœ‰ä¸€äº›æŒç»­æ›´æ–°çš„æ•°æ®éœ€è¦åœ¨å®¹å™¨ä¹‹é—´å…±äº«ï¼Œ æœ€å¥½åˆ›å»ºæ•°æ®å·å®¹å™¨ã€‚
æ•°æ®å·å®¹å™¨ï¼Œ å…¶å®å°±æ˜¯ä¸€ä¸ªæ­£å¸¸çš„å®¹å™¨ï¼Œ ä¸“é—¨ç”¨æ¥æä¾›æ•°æ®å·ä¾›å…¶å®ƒå®¹å™¨æŒ‚è½½çš„ã€‚
é¦–å…ˆï¼Œ åˆ›å»ºä¸€ä¸ªåä¸º dbdata çš„æ•°æ®å·å®¹å™¨ï¼š</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@localhost ~]#  docker run <span class="nt">-d</span> <span class="nt">-v</span> /opt/docker/docker-dbdata  <span class="nt">--name</span> dbdata training/postgres
</code></pre></div></div>

<p>ç„¶åï¼Œ åœ¨å…¶ä»–å®¹å™¨ä¸­ä½¿ç”¨ â€“volumes-from æ¥æŒ‚è½½ dbdata å®¹å™¨ä¸­çš„æ•°æ®å·ã€‚</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@localhost ~]#  docker run <span class="nt">-d</span> <span class="nt">--volumes-from</span> dbdata <span class="nt">--name</span> db1 training/postgres  
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@localhost ~]#  docker run <span class="nt">-d</span> <span class="nt">--volumes-from</span> dbdata <span class="nt">--name</span> db2 training/postgres
</code></pre></div></div>

<p>å¯ä»¥ä½¿ç”¨è¶…è¿‡ä¸€ä¸ªçš„ â€“volumes-from å‚æ•°æ¥æŒ‡å®šä»å¤šä¸ªå®¹å™¨æŒ‚è½½ä¸åŒçš„æ•°æ®å·ã€‚ ä¹Ÿå¯ä»¥ä»å…¶ä»–å·²ç»æŒ‚è½½äº†æ•°æ®å·çš„å®¹å™¨æ¥çº§è”æŒ‚è½½æ•°æ®å· ã€‚</p>
:ET